"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getUnsupportedTargets = getUnsupportedTargets;
exports.default = exports.targetMetadata = void 0;

var _data = _interopRequireDefault(require("caniuse-db/fulldata-json/data-2.0.json"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

// $FlowFixMe: Flow import error
// HACK: modern targets should be determined once at runtime
const targetMetadata = {
  targets: ['chrome', 'firefox', 'opera', 'safari', 'ie', 'edge', 'ios_saf', 'op_mini', 'android', 'bb', 'op_mob', 'and_chr', 'and_ff', 'ie_mob', 'and_uc', 'samsung', 'baidu']
};
exports.targetMetadata = targetMetadata;
const targetNameMappings = {
  chrome: 'Chrome',
  firefox: 'Firefox',
  opera: 'Opera',
  baidu: 'Baidu',
  and_qq: 'QQ Browser',
  safari: 'Safari',
  android: 'Android Browser',
  ie: 'IE',
  edge: 'Edge',
  ios_saf: 'iOS Safari',
  op_mini: 'Opera Mini',
  bb: 'Blackberry Browser',
  op_mob: 'Opera Mobile',
  and_chr: 'Android Chrome',
  and_ff: 'Android Firefox',
  ie_mob: 'IE Mobile',
  and_uc: 'Android UC Browser',
  samsung: 'Samsung Browser'
};
/**
 * Take a target's id and return it's full name by using `targetNameMappings`
 * ex. {target: and_ff, version: 40} => 'Android FireFox 40'
 */

function formatTargetNames(target) {
  return `${targetNameMappings[target.target]} ${target.version}`;
}
/**
 * Check if a browser version is in the range format
 * ex. 10.0-10.2
 */


function versionIsRange(version) {
  return version.includes('-');
}
/**
 * Parse version from caniuse and compare with parsed version from browserslist.
 */


function compareRanges(targetVersion, statsVersion) {
  return targetVersion === parseFloat(statsVersion);
}
/*
 * Check the CanIUse database to see if targets are supported
 */


function canIUseIsNotSupported(node, {
  version,
  target,
  parsedVersion
}) {
  const {
    stats
  } = _data.default.data[node.caniuseId];
  const targetStats = stats[target];
  return versionIsRange(version) ? Object.keys(targetStats).some(statsVersion => versionIsRange(statsVersion) && compareRanges(parsedVersion, statsVersion) ? !targetStats[statsVersion].includes('y') : false) : targetStats[version] && !targetStats[version].includes('y');
}
/**
 * Return an array of all unsupported targets
 */


function getUnsupportedTargets(node, targets) {
  return targets.filter(target => canIUseIsNotSupported(node, target)).map(formatTargetNames);
}

const CanIUseProvider = [// new ServiceWorker()
{
  caniuseId: 'serviceworkers',
  astNodeType: 'NewExpression',
  object: 'ServiceWorker'
}, {
  caniuseId: 'serviceworkers',
  astNodeType: 'MemberExpression',
  object: 'navigator',
  property: 'serviceWorker'
}, // document.querySelector()
{
  caniuseId: 'queryselector',
  astNodeType: 'MemberExpression',
  object: 'document',
  property: 'querySelector'
}, // IntersectionObserver
{
  caniuseId: 'intersectionobserver',
  astNodeType: 'NewExpression',
  object: 'IntersectionObserver'
}, // PaymentRequest
{
  caniuseId: 'payment-request',
  astNodeType: 'NewExpression',
  object: 'PaymentRequest'
}, // Promises
{
  caniuseId: 'promises',
  astNodeType: 'NewExpression',
  object: 'Promise'
}, {
  caniuseId: 'promises',
  astNodeType: 'MemberExpression',
  object: 'Promise',
  property: 'resolve'
}, {
  caniuseId: 'promises',
  astNodeType: 'MemberExpression',
  object: 'Promise',
  property: 'all'
}, {
  caniuseId: 'promises',
  astNodeType: 'MemberExpression',
  object: 'Promise',
  property: 'race'
}, {
  caniuseId: 'promises',
  astNodeType: 'MemberExpression',
  object: 'Promise',
  property: 'reject'
}, // fetch
{
  caniuseId: 'fetch',
  astNodeType: 'CallExpression',
  object: 'fetch'
}, // document.currentScript()
{
  caniuseId: 'document-currentscript',
  astNodeType: 'MemberExpression',
  object: 'document',
  property: 'currentScript'
}, // URL
{
  caniuseId: 'url',
  astNodeType: 'NewExpression',
  object: 'URL'
}, // URLSearchParams
{
  caniuseId: 'urlsearchparams',
  astNodeType: 'NewExpression',
  object: 'URLSearchParams'
}, // performance.now()
{
  caniuseId: 'high-resolution-time',
  astNodeType: 'MemberExpression',
  object: 'performance',
  property: 'now'
}, {
  caniuseId: 'typedarrays',
  astNodeType: 'NewExpression',
  object: 'TypedArray'
}, {
  caniuseId: 'typedarrays',
  astNodeType: 'NewExpression',
  object: 'Int8Array'
}, {
  caniuseId: 'typedarrays',
  astNodeType: 'NewExpression',
  object: 'Uint8Array'
}, {
  caniuseId: 'typedarrays',
  astNodeType: 'NewExpression',
  object: 'Uint8ClampedArray'
}, {
  caniuseId: 'typedarrays',
  astNodeType: 'NewExpression',
  object: 'Int16Array'
}, {
  caniuseId: 'typedarrays',
  astNodeType: 'NewExpression',
  object: 'Uint16Array'
}, {
  caniuseId: 'typedarrays',
  astNodeType: 'NewExpression',
  object: 'Int32Array'
}, {
  caniuseId: 'typedarrays',
  astNodeType: 'NewExpression',
  object: 'Uint32Array'
}, {
  caniuseId: 'typedarrays',
  astNodeType: 'NewExpression',
  object: 'Float32Array'
}, {
  caniuseId: 'typedarrays',
  astNodeType: 'NewExpression',
  object: 'Float64Array'
}].map(rule => Object.assign({}, rule, {
  getUnsupportedTargets,
  id: rule.property ? `${rule.object}.${rule.property}` : rule.object,
  protoChainId: rule.property ? `${rule.object}.${rule.property}` : rule.object,
  protoChain: rule.property ? [rule.object, rule.property] : [rule.object]
}));
var _default = CanIUseProvider;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9wcm92aWRlcnMvQ2FuSVVzZVByb3ZpZGVyLmpzIl0sIm5hbWVzIjpbInRhcmdldE1ldGFkYXRhIiwidGFyZ2V0cyIsInRhcmdldE5hbWVNYXBwaW5ncyIsImNocm9tZSIsImZpcmVmb3giLCJvcGVyYSIsImJhaWR1IiwiYW5kX3FxIiwic2FmYXJpIiwiYW5kcm9pZCIsImllIiwiZWRnZSIsImlvc19zYWYiLCJvcF9taW5pIiwiYmIiLCJvcF9tb2IiLCJhbmRfY2hyIiwiYW5kX2ZmIiwiaWVfbW9iIiwiYW5kX3VjIiwic2Ftc3VuZyIsImZvcm1hdFRhcmdldE5hbWVzIiwidGFyZ2V0IiwidmVyc2lvbiIsInZlcnNpb25Jc1JhbmdlIiwiaW5jbHVkZXMiLCJjb21wYXJlUmFuZ2VzIiwidGFyZ2V0VmVyc2lvbiIsInN0YXRzVmVyc2lvbiIsInBhcnNlRmxvYXQiLCJjYW5JVXNlSXNOb3RTdXBwb3J0ZWQiLCJub2RlIiwicGFyc2VkVmVyc2lvbiIsInN0YXRzIiwiY2FuaXVzZVJlY29yZHMiLCJkYXRhIiwiY2FuaXVzZUlkIiwidGFyZ2V0U3RhdHMiLCJPYmplY3QiLCJrZXlzIiwic29tZSIsImdldFVuc3VwcG9ydGVkVGFyZ2V0cyIsImZpbHRlciIsIm1hcCIsIkNhbklVc2VQcm92aWRlciIsImFzdE5vZGVUeXBlIiwib2JqZWN0IiwicHJvcGVydHkiLCJydWxlIiwiYXNzaWduIiwiaWQiLCJwcm90b0NoYWluSWQiLCJwcm90b0NoYWluIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUVBOzs7O0FBREE7QUFtQkE7QUFDTyxNQUFNQSxjQUE4QixHQUFHO0FBQzVDQyxFQUFBQSxPQUFPLEVBQUUsQ0FDUCxRQURPLEVBRVAsU0FGTyxFQUdQLE9BSE8sRUFJUCxRQUpPLEVBS1AsSUFMTyxFQU1QLE1BTk8sRUFPUCxTQVBPLEVBUVAsU0FSTyxFQVNQLFNBVE8sRUFVUCxJQVZPLEVBV1AsUUFYTyxFQVlQLFNBWk8sRUFhUCxRQWJPLEVBY1AsUUFkTyxF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QyxJQUFJLENBQUNGLE1BQU8sSUFBR0UsSUFBSSxDQUFDRCxRQUFTLEVBQWhELEdBQW9EQyxJQUFJLENBQUNGLE1BRnZDO0FBR3RCSyxFQUFBQSxZQUFZLEVBQUVILElBQUksQ0FBQ0QsUUFBTCxHQUNULEdBQUVDLElBQUksQ0FBQ0YsTUFBTyxJQUFHRSxJQUFJLENBQUNELFFBQVMsRUFEdEIsR0FFVkMsSUFBSSxDQUFDRixNQUxhO0FBTXRCTSxFQUFBQSxVQUFVLEVBQUVKLElBQUksQ0FBQ0QsUUFBTCxHQUFnQixDQUFDQyxJQUFJLENBQUNGLE1BQU4sRUFBY0UsSUFBSSxDQUFDRCxRQUFuQixDQUFoQixHQUErQyxDQUFDQyxJQUFJLENBQUNGLE1BQU47QUFOckMsQ0FBeEIsQ0FqSm1DLENBQXJDO2VBMkplRixlIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQGZsb3dcbi8vICRGbG93Rml4TWU6IEZsb3cgaW1wb3J0IGVycm9yXG5pbXBvcnQgY2FuaXVzZVJlY29yZHMgZnJvbSAnY2FuaXVzZS1kYi9mdWxsZGF0YS1qc29uL2RhdGEtMi4wLmpzb24nO1xuaW1wb3J0IHR5cGUgeyBOb2RlLCBUYXJnZXRzLCBUYXJnZXQgfSBmcm9tICcuLi9MaW50VHlwZXMnO1xuXG50eXBlIFRhcmdldE1ldGFkYXRhID0ge1xuICAvLyBUaGUgbGlzdCBvZiB0YXJnZXRzIHN1cHBvcnRlZCBieSB0aGUgcHJvdmlkZXJcbiAgdGFyZ2V0czogVGFyZ2V0c1xufTtcblxudHlwZSBDYW5JVXNlU3RhdHMgPSB7XG4gIFticm93c2VyOiBzdHJpbmddOiB7XG4gICAgW3ZlcnNpb246IHN0cmluZ106IHN0cmluZ1xuICB9XG59O1xuXG50eXBlIENhbklVc2VSZWNvcmRzID0ge1xuICBkYXRhOiBDYW5JVXNlU3RhdHNcbn07XG5cbi8vIEhBQ0s6IG1vZGVybiB0YXJnZXRzIHNob3VsZCBiZSBkZXRlcm1pbmVkIG9uY2UgYXQgcnVudGltZVxuZXhwb3J0IGNvbnN0IHRhcmdldE1ldGFkYXRhOiBUYXJnZXRNZXRhZGF0YSA9IHtcbiAgdGFyZ2V0czogW1xuICAgICdjaHJvbWUnLFxuICAgICdmaXJlZm94JyxcbiAgICAnb3BlcmEnLFxuICAgICdzYWZhcmknLFxuICAgICdpZScsXG4gICAgJ2VkZ2UnLFxuICAgICdpb3Nfc2FmJyxcbiAgICAnb3BfbWluaScsXG4gICAgJ2FuZHJvaWQnLFxuICAgICdiYicsXG4gICAgJ29wX21vYicsXG4gICAgJ2FuZF9jaHInLFxuICAgICdhbmRfZmYnLFxuICAgICdpZV9tb2InLFxuICAgICdhbmRfdWMnLFxuICAgICdzYW1zdW5nJyxcbiAgICAnYmFpZHUnXG4gIF1cbn07XG5cbmNvbnN0IHRhcmdldE5hbWVNYXBwaW5ncyA9IHtcbiAgY2hyb21lOiAnQ2hyb21lJyxcbiAgZmlyZWZveDogJ0ZpcmVmb3gnLFxuICBvcGVyYTogJ09wZXJhJyxcbiAgYmFpZHU6ICdCYWlkdScsXG4gIGFuZF9xcTogJ1FRIEJyb3dzZXInLFxuICBzYWZhcmk6ICdTYWZhcmknLFxuICBhbmRyb2lkOiAnQW5kcm9pZCBCcm93c2VyJyxcbiAgaWU6ICdJRScsXG4gIGVkZ2U6ICdFZGdlJyxcbiAgaW9zX3NhZjogJ2lPUyBTYWZhcmknLFxuICBvcF9taW5pOiAnT3BlcmEgTWluaScsXG4gIGJiOiAnQmxhY2tiZXJyeSBCcm93c2VyJyxcbiAgb3BfbW9iOiAnT3BlcmEgTW9iaWxlJyxcbiAgYW5kX2NocjogJ0FuZHJvaWQgQ2hyb21lJyxcbiAgYW5kX2ZmOiAnQW5kcm9pZCBGaXJlZm94JyxcbiAgaWVfbW9iOiAnSUUgTW9iaWxlJyxcbiAgYW5kX3VjOiAnQW5kcm9pZCBVQyBCcm93c2VyJyxcbiAgc2Ftc3VuZzogJ1NhbXN1bmcgQnJvd3Nlcidcbn07XG5cbi8qKlxuICogVGFrZSBhIHRhcmdldCdzIGlkIGFuZCByZXR1cm4gaXQncyBmdWxsIG5hbWUgYnkgdXNpbmcgYHRhcmdldE5hbWVNYXBwaW5nc2BcbiAqIGV4LiB7dGFyZ2V0OiBhbmRfZmYsIHZlcnNpb246IDQwfSA9PiAnQW5kcm9pZCBGaXJlRm94IDQwJ1xuICovXG5mdW5jdGlvbiBmb3JtYXRUYXJnZXROYW1lcyh0YXJnZXQ6IFRhcmdldCk6IHN0cmluZyB7XG4gIHJldHVybiBgJHt0YXJnZXROYW1lTWFwcGluZ3NbdGFyZ2V0LnRhcmdldF19ICR7dGFyZ2V0LnZlcnNpb259YDtcbn1cblxuLyoqXG4gKiBDaGVjayBpZiBhIGJyb3dzZXIgdmVyc2lvbiBpcyBpbiB0aGUgcmFuZ2UgZm9ybWF0XG4gKiBleC4gMTAuMC0xMC4yXG4gKi9cbmZ1bmN0aW9uIHZlcnNpb25Jc1JhbmdlKHZlcnNpb246IHN0cmluZyk6IGJvb2xlYW4ge1xuICByZXR1cm4gdmVyc2lvbi5pbmNsdWRlcygnLScpO1xufVxuXG4vKipcbiAqIFBhcnNlIHZlcnNpb24gZnJvbSBjYW5pdXNlIGFuZCBjb21wYXJlIHdpdGggcGFyc2VkIHZlcnNpb24gZnJvbSBicm93c2Vyc2xpc3QuXG4gKi9cbmZ1bmN0aW9uIGNvbXBhcmVSYW5nZXModGFyZ2V0VmVyc2lvbjogbnVtYmVyLCBzdGF0c1ZlcnNpb246IHN0cmluZyk6IGJvb2xlYW4ge1xuICByZXR1cm4gdGFyZ2V0VmVyc2lvbiA9PT0gcGFyc2VGbG9hdChzdGF0c1ZlcnNpb24pO1xufVxuXG4vKlxuICogQ2hlY2sgdGhlIENhbklVc2UgZGF0YWJhc2UgdG8gc2VlIGlmIHRhcmdldHMgYXJlIHN1cHBvcnRlZFxuICovXG5mdW5jdGlvbiBjYW5JVXNlSXNOb3RTdXBwb3J0ZWQoXG4gIG5vZGU6IE5vZGUsXG4gIHsgdmVyc2lvbiwgdGFyZ2V0LCBwYXJzZWRWZXJzaW9uIH06IFRhcmdldFxuKTogYm9vbGVhbiB7XG4gIGNvbnN0IHsgc3RhdHMgfSA9IChjYW5pdXNlUmVjb3JkczogQ2FuSVVzZVJlY29yZHMpLmRhdGFbbm9kZS5jYW5pdXNlSWRdO1xuICBjb25zdCB0YXJnZXRTdGF0cyA9IHN0YXRzW3RhcmdldF07XG4gIHJldHVybiB2ZXJzaW9uSXNSYW5nZSh2ZXJzaW9uKVxuICAgID8gT2JqZWN0LmtleXModGFyZ2V0U3RhdHMpLnNvbWUoKHN0YXRzVmVyc2lvbjogc3RyaW5nKTogYm9vbGVhbiA9PlxuICAgICAgICB2ZXJzaW9uSXNSYW5nZShzdGF0c1ZlcnNpb24pICYmXG4gICAgICAgIGNvbXBhcmVSYW5nZXMocGFyc2VkVmVyc2lvbiwgc3RhdHNWZXJzaW9uKVxuICAgICAgICAgID8gIXRhcmdldFN0YXRzW3N0YXRzVmVyc2lvbl0uaW5jbHVkZXMoJ3knKVxuICAgICAgICAgIDogZmFsc2VcbiAgICAgIClcbiAgICA6IHRhcmdldFN0YXRzW3ZlcnNpb25dICYmICF0YXJnZXRTdGF0c1t2ZXJzaW9uXS5pbmNsdWRlcygneScpO1xufVxuXG4vKipcbiAqIFJldHVybiBhbiBhcnJheSBvZiBhbGwgdW5zdXBwb3J0ZWQgdGFyZ2V0c1xuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0VW5zdXBwb3J0ZWRUYXJnZXRzKFxuICBub2RlOiBOb2RlLFxuICB0YXJnZXRzOiBUYXJnZXRzXG4pOiBBcnJheTxzdHJpbmc+IHtcbiAgcmV0dXJuIHRhcmdldHNcbiAgICAuZmlsdGVyKHRhcmdldCA9PiBjYW5JVXNlSXNOb3RTdXBwb3J0ZWQobm9kZSwgdGFyZ2V0KSlcbiAgICAubWFwKGZvcm1hdFRhcmdldE5hbWVzKTtcbn1cblxuY29uc3QgQ2FuSVVzZVByb3ZpZGVyOiBBcnJheTxOb2RlPiA9IFtcbiAgLy8gbmV3IFNlcnZpY2VXb3JrZXIoKVxuICB7XG4gICAgY2FuaXVzZUlkOiAnc2VydmljZXdvcmtlcnMnLFxuICAgIGFzdE5vZGVUeXBlOiAnTmV3RXhwcmVzc2lvbicsXG4gICAgb2JqZWN0OiAnU2VydmljZVdvcmtlcidcbiAgfSxcbiAge1xuICAgIGNhbml1c2VJZDogJ3NlcnZpY2V3b3JrZXJzJyxcbiAgICBhc3ROb2RlVHlwZTogJ01lbWJlckV4cHJlc3Npb24nLFxuICAgIG9iamVjdDogJ25hdmlnYXRvcicsXG4gICAgcHJvcGVydHk6ICdzZXJ2aWNlV29ya2VyJ1xuICB9LFxuICAvLyBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKClcbiAge1xuICAgIGNhbml1c2VJZDogJ3F1ZXJ5c2VsZWN0b3InLFxuICAgIGFzdE5vZGVUeXBlOiAnTWVtYmVyRXhwcmVzc2lvbicsXG4gICAgb2JqZWN0OiAnZG9jdW1lbnQnLFxuICAgIHByb3BlcnR5OiAncXVlcnlTZWxlY3RvcidcbiAgfSxcbiAgLy8gSW50ZXJzZWN0aW9uT2JzZXJ2ZXJcbiAge1xuICAgIGNhbml1c2VJZDogJ2ludGVyc2VjdGlvbm9ic2VydmVyJyxcbiAgICBhc3ROb2RlVHlwZTogJ05ld0V4cHJlc3Npb24nLFxuICAgIG9iamVjdDogJ0ludGVyc2VjdGlvbk9ic2VydmVyJ1xuICB9LFxuICAvLyBQYXltZW50UmVxdWVzdFxuICB7XG4gICAgY2FuaXVzZUlkOiAncGF5bWVudC1yZXF1ZXN0JyxcbiAgICBhc3ROb2RlVHlwZTogJ05ld0V4cHJlc3Npb24nLFxuICAgIG9iamVjdDogJ1BheW1lbnRSZXF1ZXN0J1xuICB9LFxuICAvLyBQcm9taXNlc1xuICB7XG4gICAgY2FuaXVzZUlkOiAncHJvbWlzZXMnLFxuICAgIGFzdE5vZGVUeXBlOiAnTmV3RXhwcmVzc2lvbicsXG4gICAgb2JqZWN0OiAnUHJvbWlzZSdcbiAgfSxcbiAge1xuICAgIGNhbml1c2VJZDogJ3Byb21pc2VzJyxcbiAgICBhc3ROb2RlVHlwZTogJ01lbWJlckV4cHJlc3Npb24nLFxuICAgIG9iamVjdDogJ1Byb21pc2UnLFxuICAgIHByb3BlcnR5OiAncmVzb2x2ZSdcbiAgfSxcbiAge1xuICAgIGNhbml1c2VJZDogJ3Byb21pc2VzJyxcbiAgICBhc3ROb2RlVHlwZTogJ01lbWJlckV4cHJlc3Npb24nLFxuICAgIG9iamVjdDogJ1Byb21pc2UnLFxuICAgIHByb3BlcnR5OiAnYWxsJ1xuICB9LFxuICB7XG4gICAgY2FuaXVzZUlkOiAncHJvbWlzZXMnLFxuICAgIGFzdE5vZGVUeXBlOiAnTWVtYmVyRXhwcmVzc2lvbicsXG4gICAgb2JqZWN0OiAnUHJvbWlzZScsXG4gICAgcHJvcGVydHk6ICdyYWNlJ1xuICB9LFxuICB7XG4gICAgY2FuaXVzZUlkOiAncHJvbWlzZXMnLFxuICAgIGFzdE5vZGVUeXBlOiAnTWVtYmVyRXhwcmVzc2lvbicsXG4gICAgb2JqZWN0OiAnUHJvbWlzZScsXG4gICAgcHJvcGVydHk6ICdyZWplY3QnXG4gIH0sXG4gIC8vIGZldGNoXG4gIHtcbiAgICBjYW5pdXNlSWQ6ICdmZXRjaCcsXG4gICAgYXN0Tm9kZVR5cGU6ICdDYWxsRXhwcmVzc2lvbicsXG4gICAgb2JqZWN0OiAnZmV0Y2gnXG4gIH0sXG4gIC8vIGRvY3VtZW50LmN1cnJlbnRTY3JpcHQoKVxuICB7XG4gICAgY2FuaXVzZUlkOiAnZG9jdW1lbnQtY3VycmVudHNjcmlwdCcsXG4gICAgYXN0Tm9kZVR5cGU6ICdNZW1iZXJFeHByZXNzaW9uJyxcbiAgICBvYmplY3Q6ICdkb2N1bWVudCcsXG4gICAgcHJvcGVydHk6ICdjdXJyZW50U2NyaXB0J1xuICB9LFxuICAvLyBVUkxcbiAge1xuICAgIGNhbml1c2VJZDogJ3VybCcsXG4gICAgYXN0Tm9kZVR5cGU6ICdOZXdFeHByZXNzaW9uJyxcbiAgICBvYmplY3Q6ICdVUkwnXG4gIH0sXG4gIC8vIFVSTFNlYXJjaFBhcmFtc1xuICB7XG4gICAgY2FuaXVzZUlkOiAndXJsc2VhcmNocGFyYW1zJyxcbiAgICBhc3ROb2RlVHlwZTogJ05ld0V4cHJlc3Npb24nLFxuICAgIG9iamVjdDogJ1VSTFNlYXJjaFBhcmFtcydcbiAgfSxcbiAgLy8gcGVyZm9ybWFuY2Uubm93KClcbiAge1xuICAgIGNhbml1c2VJZDogJ2hpZ2gtcmVzb2x1dGlvbi10aW1lJyxcbiAgICBhc3ROb2RlVHlwZTogJ01lbWJlckV4cHJlc3Npb24nLFxuICAgIG9iamVjdDogJ3BlcmZvcm1hbmNlJyxcbiAgICBwcm9wZXJ0eTogJ25vdydcbiAgfSxcbiAge1xuICAgIGNhbml1c2VJZDogJ3R5cGVkYXJyYXlzJyxcbiAgICBhc3ROb2RlVHlwZTogJ05ld0V4cHJlc3Npb24nLFxuICAgIG9iamVjdDogJ1R5cGVkQXJyYXknXG4gIH0sXG4gIHtcbiAgICBjYW5pdXNlSWQ6ICd0eXBlZGFycmF5cycsXG4gICAgYXN0Tm9kZVR5cGU6ICdOZXdFeHByZXNzaW9uJyxcbiAgICBvYmplY3Q6ICdJbnQ4QXJyYXknXG4gIH0sXG4gIHtcbiAgICBjYW5pdXNlSWQ6ICd0eXBlZGFycmF5cycsXG4gICAgYXN0Tm9kZVR5cGU6ICdOZXdFeHByZXNzaW9uJyxcbiAgICBvYmplY3Q6ICdVaW50OEFycmF5J1xuICB9LFxuICB7XG4gICAgY2FuaXVzZUlkOiAndHlwZWRhcnJheXMnLFxuICAgIGFzdE5vZGVUeXBlOiAnTmV3RXhwcmVzc2lvbicsXG4gICAgb2JqZWN0OiAnVWludDhDbGFtcGVkQXJyYXknXG4gIH0sXG4gIHtcbiAgICBjYW5pdXNlSWQ6ICd0eXBlZGFycmF5cycsXG4gICAgYXN0Tm9kZVR5cGU6ICdOZXdFeHByZXNzaW9uJyxcbiAgICBvYmplY3Q6ICdJbnQxNkFycmF5J1xuICB9LFxuICB7XG4gICAgY2FuaXVzZUlkOiAndHlwZWRhcnJheXMnLFxuICAgIGFzdE5vZGVUeXBlOiAnTmV3RXhwcmVzc2lvbicsXG4gICAgb2JqZWN0OiAnVWludDE2QXJyYXknXG4gIH0sXG4gIHtcbiAgICBjYW5pdXNlSWQ6ICd0eXBlZGFycmF5cycsXG4gICAgYXN0Tm9kZVR5cGU6ICdOZXdFeHByZXNzaW9uJyxcbiAgICBvYmplY3Q6ICdJbnQzMkFycmF5J1xuICB9LFxuICB7XG4gICAgY2FuaXVzZUlkOiAndHlwZWRhcnJheXMnLFxuICAgIGFzdE5vZGVUeXBlOiAnTmV3RXhwcmVzc2lvbicsXG4gICAgb2JqZWN0OiAnVWludDMyQXJyYXknXG4gIH0sXG4gIHtcbiAgICBjYW5pdXNlSWQ6ICd0eXBlZGFycmF5cycsXG4gICAgYXN0Tm9kZVR5cGU6ICdOZXdFeHByZXNzaW9uJyxcbiAgICBvYmplY3Q6ICdGbG9hdDMyQXJyYXknXG4gIH0sXG4gIHtcbiAgICBjYW5pdXNlSWQ6ICd0eXBlZGFycmF5cycsXG4gICAgYXN0Tm9kZVR5cGU6ICdOZXdFeHByZXNzaW9uJyxcbiAgICBvYmplY3Q6ICdGbG9hdDY0QXJyYXknXG4gIH1cbl0ubWFwKHJ1bGUgPT5cbiAgT2JqZWN0LmFzc2lnbih7fSwgcnVsZSwge1xuICAgIGdldFVuc3VwcG9ydGVkVGFyZ2V0cyxcbiAgICBpZDogcnVsZS5wcm9wZXJ0eSA/IGAke3J1bGUub2JqZWN0fS4ke3J1bGUucHJvcGVydHl9YCA6IHJ1bGUub2JqZWN0LFxuICAgIHByb3RvQ2hhaW5JZDogcnVsZS5wcm9wZXJ0eVxuICAgICAgPyBgJHtydWxlLm9iamVjdH0uJHtydWxlLnByb3BlcnR5fWBcbiAgICAgIDogcnVsZS5vYmplY3QsXG4gICAgcHJvdG9DaGFpbjogcnVsZS5wcm9wZXJ0eSA/IFtydWxlLm9iamVjdCwgcnVsZS5wcm9wZXJ0eV0gOiBbcnVsZS5vYmplY3RdXG4gIH0pXG4pO1xuXG5leHBvcnQgZGVmYXVsdCBDYW5JVXNlUHJvdmlkZXI7XG4iXX0=